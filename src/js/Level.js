class Level {
	constructor({ canvasSize, stepSize, safeAreaPosition, state, assets }) {
		this._canvasSize = canvasSize;
		this._stepSize = stepSize;
		this._safeAreaPosition = safeAreaPosition;
		this._state = state;
		this._assets = assets;
		this._levelIndex = this._state.getLevelIndex();

		this._mapSize = {
			width: 0,
			height: 0,
		}

		this._map = this._setMap(Level.MAPS[this._levelIndex]);
		
		this.setSize();
	}

	_setMap(map) {
		return map.map((row, y) => {
			return row.map((key, x) => {
				
				if (!key) return key;

				return new Brick({
					...Brick.TYPES[key],
					coords: { x, y },
					stepSize: this._stepSize,
					safeAreaPosition: this._safeAreaPosition,
					assets: this._assets,
				})
			})
		})
	}

	render(ctx, layer) {
		if (layer === 'bottom') {
			ctx.fillStyle = '#000000';
			ctx.fillRect(this._safeAreaPosition.x, this._safeAreaPosition.y, this._mapSize.width, this._mapSize.height);
		}

		this._map.forEach(row => {
			row.forEach(brick => {
				if (brick && brick.getLayer() === layer) brick.render(ctx);
			})
		})
	}

	setSize() {
		this._mapSize.width = this._stepSize.width * Level.MAP_WIDTH_SCALE_FACTOR;
		this._mapSize.height = this._stepSize.height * Level.MAP_HEIGHT_SCALE_FACTOR;

		this._map.forEach(row => {
			row.forEach(brick => {
				if (brick) brick.setSize();
			})
		})
	}

	destroyBricks(bricks) {
		bricks.forEach(brick => {
			if (brick.getBreakByBullet()) {
				const { x, y } = brick.getCoords();
				this._map[y][x] = 0;
			}
		})
	}

	getMap() {
		return this._map;
	}

	getMapSize() {
		return this._mapSize;
	}
}

Level.MAP_WIDTH_SCALE_FACTOR = 52;
Level.MAP_HEIGHT_SCALE_FACTOR = 52;
Level.MAPS = {
	1: [
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 3, 4, 3, 4, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 5, 6, 5, 6, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 3, 4, 3, 4, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 5, 6, 5, 6, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2],
		[2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1],
		[3, 4, 3, 4, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 3, 4, 3, 4],
		[5, 6, 5, 6, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 5, 6, 5, 6],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0, 1, 2, 1, 2, 0, 0, 0, 0],
		[0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0, 2, 1, 2, 1, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
	],
}
